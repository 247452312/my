<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>redis详情</title>
    <meta content="webkit" name="renderer">
    <!--设置1个小时的缓存-->
    <meta content="max-age=3200" http-equiv="Cache-Control"/>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
    <link href="/lib/layui-v2.5.5/css/layui.css" media="all" rel="stylesheet">
    <link href="/lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all" rel="stylesheet">
    <link href="/css/public.css" media="all" rel="stylesheet">
    <link href="/css/soulTable.css" media="all" rel="stylesheet">
    <link href="/css/animate.min.css" media="all" rel="stylesheet">
    <style>
        .layui-card {
            border: 1px solid #f2f2f2;
            border-radius: 5px;
        }

        .icon {
            margin-right: 10px;
            color: #1aa094;
        }

        .icon-cray {
            color: #ffb800 !important;
        }

        .icon-blue {
            color: #1e9fff !important;
        }

        .icon-tip {
            color: #ff5722 !important;
        }

        .layuimini-qiuck-module {
            text-align: center;
            margin-top: 10px
        }

        .layuimini-qiuck-module a i {
            display: inline-block;
            width: 100%;
            height: 60px;
            line-height: 60px;
            text-align: center;
            border-radius: 2px;
            font-size: 30px;
            background-color: #F8F8F8;
            color: #333;
            transition: all .3s;
            -webkit-transition: all .3s;
        }

        .layuimini-qiuck-module a cite {
            position: relative;
            top: 2px;
            display: block;
            color: #666;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            font-size: 14px;
        }

        .welcome-module {
            width: 100%;
            height: 210px;
        }

        .panel {
            background-color: #fff;
            border: 1px solid transparent;
            border-radius: 3px;
            -webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
            box-shadow: 0 1px 1px rgba(0, 0, 0, .05)
        }

        .panel-body {
            padding: 10px
        }

        .panel-title {
            margin-top: 0;
            margin-bottom: 0;
            font-size: 12px;
            color: inherit
        }

        .label {
            display: inline;
            padding: .2em .6em .3em;
            font-size: 75%;
            font-weight: 700;
            line-height: 1;
            color: #fff;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: .25em;
            margin-top: .3em;
        }

        .layui-red {
            color: red
        }

        .main_btn > p {
            height: 40px;
        }

        .layui-bg-number {
            background-color: #F8F8F8;
        }

        .layuimini-notice:hover {
            background: #f6f6f6;
        }

        .layuimini-notice {
            padding: 7px 16px;
            clear: both;
            font-size: 12px !important;
            cursor: pointer;
            position: relative;
            transition: background 0.2s ease-in-out;
        }

        .layuimini-notice-title, .layuimini-notice-label {
            padding-right: 70px !important;
            text-overflow: ellipsis !important;
            overflow: hidden !important;
            white-space: nowrap !important;
        }

        .layuimini-notice-title {
            line-height: 28px;
            font-size: 14px;
        }

        .layuimini-notice-extra {
            position: absolute;
            top: 50%;
            margin-top: -8px;
            right: 16px;
            display: inline-block;
            height: 16px;
            color: #999;
        }

        .layui-form-select {
            width: 130px;
        }

        .welcome-module {
            height: 250px;
        }
    </style>
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main">
        <div class="layui-row layui-col-space15">
            <!--右侧3-->
            <div class="layui-col-md2">
                <div class="layui-row layui-col-space15">
                    <!--设置与刷新按钮-->
                    <div class="layui-col-md12" style="text-align: center;">
                        <button class="layui-btn layui-btn-radius layui-btn-primary layui-btn-xs " id="menu_redis"><i
                                class="fa fa-reorder"></i></button>
                        <button class="layui-btn layui-btn-radius layui-btn-primary layui-btn-xs " id="off_on_redis"><i
                                class="fa fa-power-off"></i></button>
                        <button class="layui-btn layui-btn-radius layui-btn-primary layui-btn-xs " id="refresh_redis"><i
                                class="fa fa-refresh"></i></button>
                    </div>
                    <!--切换db和新建-->
                    <div class="layui-col-md12" style="text-align: center;">
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <form action="" class="layui-form">
                                    <select id="redis-db" lay-filter="redis-db" lay-search lay-verify="">
                                        <option value="">请选择数据库</option>
                                    </select>
                                </form>
                            </div>
                            <div class="layui-input-inline">
                                <button class="layui-btn" id="addRedisKey"><i
                                        class="fa fa-plus-circle"></i> 添加key
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!--数据展示-->
                <div class="layui-col-md12" style="text-align: center;">
                    <table class="layui-hide" id="redis-keys-table" lay-filter="redis-keys-table"></table>
                </div>
            </div>

            <div class="layui-col-md10">
                <div class="layui-row layui-col-space15">
                    <!--表格1-->
                    <div class="layui-col-md4">
                        <div class="layui-card">
                            <div class="layui-card-header"><i class="fa fa-warning icon"></i>server信息</div>
                            <div class="layui-card-body">
                                <div class="welcome-module">
                                    <div class="layui-row layui-col-space10">
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-red">实时</span>
                                                        <h5>redis运行模式</h5>
                                                        <!--redis_mode-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="redis_mode">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-orange">实时</span>
                                                        <h5>操作系统</h5>
                                                        <!--os-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="os">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-green">实时</span>
                                                        <h5>PID</h5>
                                                        <!--process_id-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="process_id">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-cyan">实时</span>
                                                        <h5>运行时间</h5>
                                                        <!--uptime_in_days-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="uptime_in_days">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-blue">实时</span>
                                                        <h5>端口</h5>
                                                        <!--tcp_port-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="tcp_port">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-gray">实时</span>
                                                        <h5>版本</h5>
                                                        <!--redis_version-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="redis_version">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--表格2-->
                    <div class="layui-col-md4">
                        <div class="layui-card">
                            <div class="layui-card-header"><i class="fa fa-warning icon"></i>客户端信息</div>
                            <div class="layui-card-body">
                                <div class="welcome-module">
                                    <div class="layui-row layui-col-space10">
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-red">实时</span>
                                                        <h5>已连接客户端的数量</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="connected_clients">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-orange">实时</span>
                                                        <h5>最长的输出列表</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins"
                                                            into-name="client_recent_max_output_buffer">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-green">实时</span>
                                                        <h5>最大输入缓存</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins"
                                                            into-name="client_recent_max_input_buffer">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-cyan">实时</span>
                                                        <h5>正在等待阻塞命令</h5>
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="blocked_clients">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--表格3-->
                    <div class="layui-col-md4">
                        <div class="layui-card">
                            <div class="layui-card-header"><i class="fa fa-warning icon"></i>内存信息</div>
                            <div class="layui-card-body">
                                <div class="welcome-module">
                                    <div class="layui-row layui-col-space10">
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-red">实时</span>
                                                        <h5>已用</h5>
                                                        <!--used_memory_human-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="used_memory_human">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-orange">实时</span>
                                                        <h5>消耗峰值</h5>
                                                        <!--used_memory_peak_human-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="used_memory_peak_human">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-green">实时</span>
                                                        <h5>对比峰值的消耗(%)</h5>
                                                        <!--used_memory_peak_perc-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="used_memory_peak_perc">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-cyan">实时</span>
                                                        <h5>最大内存</h5>
                                                        <!--maxmemory_human-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="maxmemory_human">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-blue">实时</span>
                                                        <h5>内存分配器</h5>
                                                        <!--mem_allocator-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="mem_allocator">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-gray">实时</span>
                                                        <h5>淘汰策略</h5>
                                                        <!--maxmemory_policy-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="maxmemory_policy">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--表格4-->
                    <div class="layui-col-md4">
                        <div class="layui-card">
                            <div class="layui-card-header"><i class="fa fa-warning icon"></i>持久化信息</div>
                            <div class="layui-card-body">
                                <div class="welcome-module">
                                    <div class="layui-row layui-col-space10">
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-red">实时</span>
                                                        <h5>是否正在持久化</h5>
                                                        <!--loading-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="loading">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-orange">实时</span>
                                                        <h5>是否开启了AOF</h5>
                                                        <!--aof_enabled-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="aof_enabled">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-green">实时</span>
                                                        <h5>没有持久化的写入命令</h5>
                                                        <!--rdb_changes_since_last_save-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="rdb_changes_since_last_save">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-cyan">实时</span>
                                                        <h5>上次aof写入状态</h5>
                                                        <!--aof_last_write_status-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="aof_last_write_status">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--表格5-->
                    <div class="layui-col-md4">
                        <div class="layui-card">
                            <div class="layui-card-header"><i class="fa fa-warning icon"></i>统计信息</div>
                            <div class="layui-card-body">
                                <div class="welcome-module">
                                    <div class="layui-row layui-col-space10">
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-red">实时</span>
                                                        <h5>新创建连接个数</h5>
                                                        <!--total_connections_received-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="total_connections_received">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-orange">实时</span>
                                                        <h5>QPS</h5>
                                                        <!--instantaneous_ops_per_sec-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="instantaneous_ops_per_sec">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-green">实时</span>
                                                        <h5>网络入口kps</h5>
                                                        <!--instantaneous_input_kbps-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="instantaneous_input_kbps">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-cyan">实时</span>
                                                        <h5>网络出口kps</h5>
                                                        <!--instantaneous_output_kbps-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="instantaneous_output_kbps">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-blue">实时</span>
                                                        <h5>命中次数</h5>
                                                        <!--keyspace_hits-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="keyspace_hits">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-gray">实时</span>
                                                        <h5>没命中次数</h5>
                                                        <!--keyspace_misses-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="keyspace_misses">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--表格6-->
                    <div class="layui-col-md4">
                        <div class="layui-card">
                            <div class="layui-card-header"><i class="fa fa-warning icon"></i>CPU</div>
                            <div class="layui-card-body">
                                <div class="welcome-module">
                                    <div class="layui-row layui-col-space10">
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-red">实时</span>
                                                        <h5>主进程-核心态-CPU</h5>
                                                        <!--used_cpu_sys-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="used_cpu_sys">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-orange">实时</span>
                                                        <h5>主进程-用户态-CPU</h5>
                                                        <!--used_cpu_user-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="used_cpu_user">无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-green">实时</span>
                                                        <h5>后台-核心态-CPU</h5>
                                                        <!--used_cpu_sys_children-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="used_cpu_sys_children">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="layui-col-xs6">
                                            <div class="panel layui-bg-number">
                                                <div class="panel-body">
                                                    <div class="panel-title">
                                                        <span class="label pull-right layui-bg-cyan">实时</span>
                                                        <h5>后台-用户态-CPU</h5>
                                                        <!--used_cpu_user_children-->
                                                    </div>
                                                    <div class="panel-content">
                                                        <h2 class="no-margins" into-name="used_cpu_user_children">
                                                            无</h2>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script id="operation" type="text/html">
    <a class="layui-btn layui-btn-xs" data-d="" lay-event="edit">修改</a>
    <a class="layui-btn layui-btn-xs" data-d="" lay-event="del">删除</a>
</script>

<script charset="utf-8" src="/js/jquery.min.js"></script>
<script charset="utf-8" src="/js/my.js"></script>
<script charset="utf-8" src="/lib/layui-v2.5.5/layui.js"></script>
<script charset="utf-8" src="/js/lay-config.js?v=1.0.4"></script>
<script>

    var status = 1;
    layui.use(['layer', 'form', 'table', 'soulTable'], function () {
        var $ = layui.jquery,
            layer = layui.layer,
            form = layui.form,
            table = layui.table,
            soulTable = layui.soulTable;

        $.getUrlParam = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        };
        let id = $.getUrlParam('id');

        /*获取redis的数据库*/
        pushRequest("RedisService", "getRedisDb", {id: id}, function (data) {
            for (let i = 0; i < data; i++) {
                $("#redis-db").append("<option value='" + i + "'>db" + i + "</option>")
            }
        });

        form.on('select(redis-db)', function (data) {
            reloadTable();
        });

        var getRedisInfos = function () {
            if (status == 1) {
                /*获取redis的所有info*/
                pushRequest("RedisService", "getInfos", {id: id}, function (data) {
                    for (let i = 0; i < data.length; i++) {
                        let $1 = $("[into-name='" + data[i].name + "']");
                        if ($1.length > 0) {
                            if (data[i].name == "os") {
                                data[i].value = data[i].value.split(" ")[0];
                            }
                            $1.html(data[i].value);
                        } else {
                            $1.html("无");
                        }
                    }
                });
            } else {
                layer.msg("redis没有开启,获取信息失败");
            }
        };

        /* redis开关,如果开了就关 如果关了就开 */
        $("#off_on_redis").click(function () {
            if (status == 1) { // 说明现在是开着的,要关了
                layer.confirm('是否确认关闭', {
                    btn: ['确认', '取消'] //按钮
                }, function () {
                    pushRequest("RedisService", "stop", {id: id}, function (data) {
                        status = data.status;
                        layer.msg(data.msg);
                        getRedisInfos();
                        reloadTable();
                    });
                }, function () {
                });
            } else { // 说明现在没有开启,开启
                layer.confirm('是否确认开启', {
                    btn: ['确认', '取消'] //按钮
                }, function () {
                    pushRequest("RedisService", "start", {id: id}, function (data) {
                        status = data.status;
                        layer.msg(data.msg);
                        getRedisInfos();
                        reloadTable();
                    });
                }, function () {
                });
            }
        });
        /* 刷新按钮 */
        $("#refresh_redis").click(function () {
            getRedisInfos();
        });
        $("#addRedisKey").click(function () {
                // 获取数据库的值
                let value = $("#redis-db").val();
                if (value == null || value == "") {
                    layer.msg("请选择数据库");
                    return;
                }
                var index = layer.open({
                    title: '添加redis key',
                    type: 2,
                    shade: 0.2,
                    maxmin: true,
                    shadeClose: true,
                    area: ['30%', '40%'],
                    content: 'redisKeyAdd.html?func=add&db=' + value + '&redisId=' + id,
                });
                $(window).on("resize", function () {
                    layer.full(index);
                });
            }
        );
        //监听行工具事件
        table.on('tool(redis-keys-table)', function (obj) {
            var data = obj.data;
            //console.log(obj)
            if (obj.event == 'del') { // 删除
                layer.confirm('真的删除行么', function (index) {
                    pushRequest("RedisService", "deleteRedisByKey", {
                        data: {
                            redisId: id, key: data.key,
                            class: 'indi.uhyils.pojo.model.RedisKeyAndValue'
                        }
                    }, function (data) {
                        layer.msg("删除成功");
                        layer.close(index);
                        reloadTable();
                    });
                });
            } else if (obj.event == 'edit') {
                let value = $("#redis-db").val();

                var index = layer.open({
                    title: '设置key',
                    type: 2,
                    shade: 0.2,
                    maxmin: true,
                    shadeClose: true,
                    area: ['30%', '50%'],
                    content: 'redisKeyAdd.html?func=edit&key=' + data.key + '&db=' + value + '&redisId=' + id,
                });
                $(window).on("resize", function () {
                    layer.full(index);
                });
            }
        });
        var reloadTable = function () {
            let value = $("#redis-db").val();
            if (value !== "") {
                pushRequest("RedisService", "getRedisKeys", {db: value, redisId: id}, function (dataBack) {
                    table.render({
                        elem: '#redis-keys-table'
                        , data: dataBack
                        , height: 400
                        , cols: [[
                            {field: 'key', title: 'key', filter: true},
                            {title: '操作', width: 112, align: 'center', toolbar: '#operation'}
                        ]]
                        , done: function () {
                            soulTable.render(this);
                        }
                        , page: false
                    });
                })
            } else {
                table.render({
                    elem: '#redis-keys-table'
                    , data: []
                    , height: 540
                    , cols: [[
                        {field: 'key', title: 'key', filter: true},
                        {title: '操作', width: 112, align: 'center', toolbar: '#operation'}
                    ]]
                    , done: function () {
                        soulTable.render(this);
                    }
                    , page: false
                });
            }
        };
        getRedisInfos();
        reloadTable();
        form.render();
    });
</script>
</body>
</html>
